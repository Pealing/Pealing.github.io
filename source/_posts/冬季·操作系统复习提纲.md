---
title: 冬季·操作系统复习提纲
date: 2017-03-19 20:26:51
updated: 2017-03-19 20:26:51
categories: "冬季复习提纲"
---
# 前言
    这是一份，上海大学冬季学期的操作系统复习提纲
    基本上就是把书打了一遍
    不代表权威
    写了没考到，考了没写到
    都清不要怪我，谢谢
<!--more-->

### 第四章 存储器管理
---

#### 存储器的层次结构
    CPU寄存器：寄存器（字长通常只有8位）
    主存：高速缓存、主存储器、磁盘缓存
    辅存：固定磁盘、可移动存储介质

越接近CPU的，层次越高，存储介质的访问速度越快，价格越高，对应的存储容量越小。

* 高速缓存
    - 备份主存中较常用的数据，以减少处理机对主存储器的访问次数。
    - CPU访问一组特定的信息时，需要检查它是否在高速缓存中

* 磁盘缓存
    - 暂时存放频繁使用的一部分磁盘数据和信息，以减少访问磁盘的次数
    - 不是实际存在的存储器，利用主存中的部分存储空间暂时存放从磁盘中读出（写入）的信息

#### 程序的装入和链接
用户程序要在系统中运行，必须先将它装入内存，步骤：
1. 编译，由*编译程序*用户源程序进行编译，形成若干个*目标模块*
2. 链接，由*链接程序*将编译后形成的一组目标模块以及他们所需要的库函数链接在一起，形成*装入模块*。
3. 装入，由*装入程序*将装入模块装入内存

* 程序的装入
    - 绝对装入方式
        + 计算机系统很小，且仅能运行单道程序，编译后，将产生绝对地址（物理地址）的目标代码。
    - 可重定位装入方式
        + 多道程序环境下，把在装入时对目标程序中指令和数据地址的修改过程称为*重定位*。
        + 又称*静态重定位*（因为地址变换是在进程装入时一次完成的）
    - 动态运行时的装入方式
        + 装入模块装入内存后，不立即把装入模块中的逻辑地址转换成物理地址，而是把这种地址的转换推迟到程序真正要执行时才开始。
        + 装入内存后的地址都仍是逻辑地址
        + 需要一个*重定位寄存器*

* 程序的链接
    - 静态链接
        + 需要解决的问题：1.对相对地址进行修改；2.变换外部调用符号
        + 在程序运行之前，将各个目标模块及它们所需要的库函数链接成完整的装入模块。
    - 装入时动态链接
        + 采用边装入边链接的方式
        + 优点：1.便于修改和更新；2.便于实现对目标模块的共享
    - 运行时动态链接
        + 对某些模块的链接推迟到程序执行时才进行。

#### 连续分配存储管理方式
* 连续分配
    - 最早出现的一种存储器分配方式
    - 把内存分为*系统区*和*用户区*，系统区仅提供给OS使用，通常放在低地址部分
* 固定分区分配
    - 划分分区的方法
        + 分区大小相等（指所有的内存分区大小相等）
            * 缺点：缺乏灵活性
        + 分区大小不等
    - 内存分配
        + 将分区按其大小进行排队，并建立一张分区使用表，包括分区的起始地址、大小和状态。
* 动态分区分配 
    - 又称为可变分区分配，涉及到*数据结构*、*分区分配算法*、*分区的分配和回收操作*
    - 数据结构：空闲分区表（分区号、分区大小、分区始地址）、空闲分区链（将所有空闲分区链接成一个双向链）
    - 动态分区分配 · *大题*
        + 首次适应FF算法
            * 空闲分区链以地址递增链接，从链首顺序查找。
            * 优先利用内存中的低地址
            * 缺点：留下很多碎片
        + 循环首次适应NF算法
            * 从上次找到的空闲分区的下一个空闲分区查找
            * 应设置一起始查寻指针，用于指示下一次起始查寻的空闲分区
            * 缺点：会缺乏大的空闲分区
        + 最佳适应BF算法
            * 能满足要求、又是最小的空闲分区分配给作业
            * 因为每一次切割下的剩余部分总是最小的，所以会留下很多碎片
        + 最坏适应WF算法
            * 挑选最大的空闲去
            * 优点：产生碎片的可能性最小，对中、小作业有利，查找效率很高。
            * 将所有的空闲分区按照容量*从小到大*形成空闲分区链。
        + 快速适应算法
            * 又称为分类搜索法
            * 将空闲分区根据*容量大小*进行分类
            * 对每一类具有相同容量的分区，单独设立一个空闲分区链表。
            * a)根据进程长度，从索引表中寻找能容纳它的最小空闲区链表；b)从链表取第一块分配
        + 伙伴系统（了解）
            * 无论已分配分区或空闲分区，其大小均为2的K次幂
        + 哈希算法
            * 简历哈希函数，构造一张以空闲分区大小为关键字的哈希表
    - 分区分配算法
        + 分配内存
        + 回收内存
    
#### 对换

>是指把内存中暂时不能运行的进程或者暂时不用的程序和数据换出到外存上，以便腾出足够的内存空间，再把已具备运行条件的进程或继承所需要的程序和数据换入内存。
>对换是改善内存利用率的有效措施。
  
* 对换的类型
    - 整体对换
        + 以整个进程为单位
    - 页面（分段）对换
        + 虚拟存储器

*是改善内存利⽤率的有效措施，可以直接提⾼处理机的利⽤率和系统的吞吐量； *

#### 分页存储管理方式 · *重点*

##### 页面和物理块
* 页面
    - 将进程的逻辑地址空间分成若干个页，并为各页加以编号
    - 页面大小：页面的大小应该选择适中，通常为1KB-8KB
* 地址结构
    - 页号P+位移量W（P139）
* 页表
    - 系统为每个进程简历了一张页面映像表，记录了相应页在内存中对应的物理块号

##### 地址变换机构
* 基本的地址变换机构
* 具有快表的地址变换机构
    - 相当于地址变换机构中增设一个具有并行查寻能力的特殊高速缓冲寄存器
    - CPU给出有效地址后，由地址变换机构自动将页号P送入高速缓冲寄存器，将此页号与其中的所有页号进行比较，若有与此相匹配的页号，则表示其在快表中，直接从快表中读出对应的物理块号。
    - 若找不到，则访问内存的页表+物理地址送到地址寄存器+更新快表
    
##### 两级和多级页表

* 两级页表
    - 解决难以找到大的连续的内存空间来存放页表的问题
    - 将页表进行分页，每个页面的大小与内存物理块的大小相同
    - 外层页表

##### 反置页表
1. 为每一个物理块设置一个页表项，并将它们按照物理块的编号排序，内容是页号和其他隶属进程的标识符。
2. 根据进程标识符和页号去检索反置页表，如果检索到与之匹配的页表项，则该页表项的序号i便是该页所在的物理块号，可以用该块号和页内地址一起构成物理地址送到内存地址寄存器
3. 如果没有找到匹配的，则表明此页内还没有装入内存，表示地址出错。

#### 分段存储管理方式
>引入分段存储管理方式的目的，主要是为了满足用户（程序员）在变成和使用上多方面的要求。

* 分段
* 段表
    - 起始地址（基址）
    - 段长

* 优点
    - 方便编程
    - 信息共享
    - 信息保护
    - 动态增长
    - 动态链接

* 分段和分页的区别
    - 页是信息的物理单位，分页目的是提高内存的利用率，仅仅是系统管理上的需要，是系统行为，用户不可见
    - 段是信息的逻辑单位，分段目的在于能更好地满足用户的需要
    - 页的大小固定，且由系统决定。段的长度不固定，由编译程序根据信息的性质来划分
    - 分页的用户程序地址空间是一维的。分段用户程序的地址空间是二维的。

##### 段页式存储管理方式
>将用户程序分成若干个段，再把每个段分成若干个页，给每个段赋予一个段名。

* 段表
    - 页表始地址
    - 页表长度

* 段页式系统中，为了获得一条指令或数据，需要3次访问内存
    - 第一次访问内存中的*段表*
    - 第二次访问内存中的*页表*，获得块号和页内地址一起获得物理地址
    - 第三次访问*物理地址*，取出指令

### 第五章 虚拟存储器
*虚拟存储器是基于局部性原理*

* 传统的存储器原理（第四章）的共同特征
    - 一次性
        + 作业必须一次性全部装入内存后才能开始运行
    - 驻留性
        + 作业被装入内存后，整个作业都一直驻留在内存中

#### 局部性原理
1. 程序执行时，除了少部分的转移和过程调用指令外，在大多数情况下是顺序执行的。
2. 过程调用将会使程序的执行轨迹由一部分区域转至另一部分区域
3. 程序中存在许多循环结构
4. 程序中还包括许多对数据结构的处理

* 局限性的表现
    - 时间局限性
        + 程序中某条指令被执行，不久后可能再次被执行；数据可能再次被访问。
        + 原因：程序中存在着大量的循环操作
    - 空间局限性
        + 一旦访问了某个存储单元，不久后其附近的存储单元也将被访问
        + 程序的顺序执行

#### 虚拟存储器
>具有请求调入功能和置换功能，能从逻辑上对内存容量加以扩充的一种存储器系统。

* 特征
    - 多次性 *虚拟存储器最重要的特征*
        + 一个作业中的程序和数据允许被分成多次调入内存运行，只需要将当前要运行的那部分程序和数据装入内存即可。
    - 对换性
        + 一个作业中的程序和数据，允许在运行过程中进行换进、换出。
    - 虚拟性
        + 能够从逻辑上扩充内存容量，使用户所看到的内存容量远大于实际内存容量。

* 虚拟内存的实现
    - 分页请求系统
        + 在分页系统的基础上增加了请求调页功能和页面置换功能。
        + 硬件：*请求分页的页表机制*、*缺页中断机构*（每当用户程序要访问的页面尚未调入内存时，产生一缺页中断，以请求OS将所缺页面调入内存）、*地址变换机构**
    - 请求分段系统
        + 在分段系统的基础上，增加了请求调段及分段置换功能
        + 硬件：*请求分段的段表机制*、*缺段中断机构*、*地址变换机构*

* 缺页中断和一般中断的区别
    - 在指令执行期间产生和处理中断信号
    - 一条指令在执行期间可能产生多次缺页中断

* 页面调入策略
    - 何时调入页面
    - 何处调入页面
    - 页面调入过程
    - 缺页率 *重点*
        + 影响因素
            * 页面大小：页面较大，缺页率较低
            * 进程所分配物理块的数目，数目越多，缺页率越低
            * 页面置换算法
            * 程序固有特性

#### 页面置换算法 *重点*
* 最佳置换算法（Optimal）
    - 理想化，无法实现，作为算法优劣的评判标准
    - 被淘汰的页面将是以后永不使用的（未来最长时间内不被访问）
* 先进先出置换算法（FIFIO）
    - 淘汰最先进入内存的页面，即选择在内存中驻留时间最长的页面淘汰。
    - 可能是性能最差的算法，故实际应用极少
* 最近最久未使用算法（LRU）
    - 记录一个页面自上次被访问的以来所经历的时间t，淘汰t最大的。
* 最少使用置换算法（LFU）
    - 最近时间使用最少的页面淘汰
* CLOCK置换算法（最近未使用算法NRU）

#### 抖动
    发生抖动的原因：同时在系统中运行的进程太多，由此分配给每一个进程的物理块太少，不能满足进程正常运行的基本要求。

* 抖动的预防
    - 采取局部置换策略
    - 把工作集算法融入到处理机调度中
    - 利用“L=S”准则调节缺页率
    - 选择暂停的进程

##### 工作集
*进程发生缺页率的时间间隔和进程所获得的物理块数有关*

### 第六章 输入输出系统
>I/O系统管理的主要对象是I/O设备和相应的设备控制器，主要任务是完成用户提出的I/O请求，提高I/O速率，

* 基本功能
    - 隐藏物理设备的细节
    - 与设备的无关性
    - 提高处理机和I/O设备的利用率
    - 对I/O设备进行控制
    - 确保对设备的正确共享
    - 错误处理

*层次结构的I/O系统*可以使十分复杂的I/O软件能具有更清晰的结构，更好的可移植性和易适应性
* I/O的层次结构
    - 用户层I/O软件
    - 设备独立性软件
    - 设备驱动程序
        + 与硬件直接相关，用于具体实现系统对设备发出的操作指令。
        + 是I/O系统的高层与设备控制器之间的通信
        + 功能：
            * 接收由与设备无关的软件发来的命令和参数，并将命令中的抽象要求转换成与设备相关的低层操作序列
            * 检查用户I/O请求的合法性，了解I/O设备的工作状态，传递与I/O设备操作有关的参数，设置设备的工作方式
            * 发出I/O命令，如果设备空闲，立即启动设备，完成操作。如果设备忙碌，则将请求者的请求块挂在设备队列上等待
            * 及时响应由设备控制器发来的中断请求，并根据其中断类型，调用相应的中断处理程序进行处理
    - 中断处理程序
        + 中断是指CPU对I/O设备发来的中断信号的一种响应，是由外部设备引起的，故又称为外中断

* 对I/O设备的控制方式
    - 使用轮询的可编程I/O方式
    - 使用中断的可编程I/O方式
    - 直接存储器访问方式
        + 接存储器访问方式的引入
        + DMA控制器的组成 
            * 主机与DMA控制器的接口
            * DMA控制器与块设备的接口
            * I/O控制逻辑
    - 通道
        + 数组选择通道、字节多路通道、数组多路通道、
        + 比起DMA进一步减少CPU的干预，即把对一个数据块的读（或写）为单位的干预，减少为对一组数据块的读（写）及有关的控制和管理为单位的干预
        + 是通过执行通道程序并与设备控制器共同实现对I/0设备的控制的
        + 其性能不高

#### 缓冲区管理

* 引入缓冲区的原因
    - 缓和CPU和I/O设备间速度不匹配的矛盾
    - 减少对CPU的中断频率，放宽对CPU中断响应时间的限制
    - 解决数据粒度不匹配的问题
    - 提高CPU和I/O设备之间的并行性

* 缓冲区的工作方式
    - 收容输入：从空缓冲队列的队首找下空缓冲区
    - 提取输入：从输入队队列的队首
    - 收容输出：从空缓冲队列队首取得空缓冲
    - 提取输出：从输出队列

* 磁盘调度算法 *重点*
    - 先来先服务（FCFS)
        + 优点：公平、简单
        + 缺点：平均寻道时间长
    - 最短寻道时间优先（SSTF)
        + 要求访问的磁道与当前磁头所在的次奥距离最近
    - 扫描（SCAN)
        + 电梯算法
        + 优先考虑磁头的移动方向
    - 循环扫描（CSCAN)
        + 规定磁头单向移动（磁头移动到嘴歪的磁道并访问后，立即返回到最里的欲访问磁道）
    - NStepSCAN算法
        + 为了避免"磁臂黏着"
        + 将磁盘请求队列分成N个子队列，按FCFS算法依次处理子队列。处理每一个队列时用SCAN算法。
    - FSCAN调度算法
        + 只分成"当前所有请求磁盘I/O的进程"和"扫描期间新出现的进程"两个队列
        + 其余同NSACN

* 磁盘访问时间 *重点P217*
    - 引入磁盘调度管理的目的是，利用合理安排磁盘块的访问顺序，减少寻道时间的消耗
    - 寻道时间：磁头移动到指定磁道上所经历的时间
    - 旋转延迟时间：扇区移动到磁头下面所经历的时间
    - 传输时间：数据从磁盘读出或向磁盘写入数据所经历的时间
    - T = 寻道时间 + 1/(2*r) + b/rn  (r是每秒的转数，b是每次读写的字节数，n是扇区)

### 第七章 文件管理
>文件系统的管理功能是将其管理的程序和数据通过组织为一系列文件的方式实现的。

* 基于文件系统的概念，可以把数据组分成
    - 数据项
        + 最低级的数据组织形式
        + 基本数据项
            * 用于描述一个对象的某种属性的字符集，又称为字段
        + 组合数据项
            * 由若干个基本数据项组成的，简称组项。
    - 记录
        + 一组相关数据项的集合，用于描述一个对象在某方面的属性
    - 文件
        + 由创建者所定义的，具有文件名的一组相关元素的集合，分为*结构文件*和*无结构文件*
        + 文件属性：文件类型、文件长度、文件的物理位置、文件的建立时间

* 文件的操作
    - *创建文件* 在创建一个新文件时，要为新文件分配必要的外存空间，并在文件的目录中为之建立一个目录项；目录项中应记录新文件的文件名及其在外存的地址等属性。
    - *删除文件* 在删除时，应先从目录中找到要删除文件的目录项，使之成为空项，然后回收该文件所占用的存储空间
    - *读文件* 在读文件时，根据用户给出的文件名查找目录，从中得到被读文件在外存中的位置；在目录项中，还有一个指针用于对文件的读/写
    - *写文件* 在写文件时，根据文件名查找目录，找到指定文件的目录项，再利用目录中的写指针进行写操作。
    - *设置文件的读写位置* 通过设置文件读/写指针的位置，将顺序存取改为随机存取
    - 文件的“打开”和“关闭”操作
        + 打开：系统将指名文件的属性（包括该文件在外存上的物理位置），从外存拷贝到内存打开文件表的一个表目中，并将该表目的编号（索引号)返回给客户。
        + 关闭：OS会把该文件从打开文件表中的表目上删除掉
    - 其它文件操作
        + 改变文件名、拥有者、访问权，查询文件的状态，创建/删除目录，改变当前目录和工作目录等

#### 文件的逻辑结构
>文件的逻辑结构，是从用户观点出发所观察到的文件组织形式，即文件是由一些逻辑记录组成，是用户可以直接处理的数据及其结构，又称为*文件组织*。
>文件的物理机构，又称为*文件的存储结构*，是指系统将文件存储在外存上所形成的一种存储组织形式，是用户不能看见的。

##### 按文件是否有结构分类
* 有结构文件
    - 又称为*记录式文件*
    - 定长记录
    - 变长记录仪
* 无结构文件
    - 又称为*流式文件*

##### 按文件的组织方式分类
* 顺序文件
* 索引文件
* 索引顺序文件

##### 文件目录
>文件目录也是一种数据结构。

* 对目录管理的要求
    - 实现"按名存取"
    - 提高对目录的检索速度
    - 文件共享
    - 允许文件重名

*通常，一个文件目录也被看做是一个文件，称为目录文件*

##### 文件目录
* 单级文件目录
    - 最简单的文件目录
    - 整个文件系统中只建立一张目录表
    - 每个文件占一个目录项，含文件名、文件扩展名、文件长度、文件类型、文件物理地址以及其它文件属性
    - 每当要建立一个新文件时，必须先检索所有的目录项，以保证新文件名在目录中是唯一的。
    - 只能实现*按名存取*
    - 缺点：查找速度慢、不允许重名、不便于实现文件共享
* 两级文件目录
    - 为了克服单级文件目录所存在的缺点，可以为每个用户再简历一个单独的用户文件目录UFD。
    - 基本满足文件目录的四方面要求
    - 提高了检索目录的速度、不同的用户目录中可以使用相同的文件名、不同用户可以使用不同文件名访问系统中的同一个共享文件
* 树形结构目录
    - 现代OS中最通用且使用的文件目录
    - 主目录被称为根目录，每个文件目录中只能有一个根目录
    - 每个文件和每个目录都只能有一个父目录
    - 数据文件称为树叶
    - 其他的目录均为树的节点，称为子目录
    - 为了提高文件系统的灵活性，允许一个目录文件中的目录项，即是作为目录文件发FCB，又是数据文件的FCB

*路径名*：从根目录到任何数据文件都只有一条唯一的通路。在该路径上，从根开始，把全部目录文件名和数据文件名依次用"/"连接起来
*当前目录*：又称为"工作目录"。
*相对路径名*：从当前目录开始直到数据文件为止所构成的路径名称
*绝对路径名*：从树根开始的路径名称

* 目录操作
    - 创建目录
    - 删除目录
        + 不删除非空目录
        + 可删除非空目录
    - 改变目录
    - 移动目录
    - 链接操作
    - 查找

#### 文件共享
>指系统应允许多个用户（进程）共享同一份文件，一个文件有多个父目录

##### 文件共享的两个经典方法
###### 基于有向无循环图实现文件共享

* 有向无循环图
    - 一个文件有多个父目录
    - 文件目录中所包含的是文件所在盘块的盘块号，当向文件中添加新内容时，新增加的盘块只会出现在执行了操作的目录中，这种变化对其他用户而言是不可见的，因为新增加的这部分内容*不能被共享*
* 利用索引节点
    - 为了解决上述问题，将文件的物理地址及其属性放在索引结点中。
    - 文件目录中，设置只想共享文件的索引结点指针
    - 索引结点中还应有一个链接计数count，用于表示链接到本索引结点上的用户目录项的数目
    - 缺点：当文件主不再需要文件时，不能将文件删除，否则其余文件会有指针悬空。

##### 利用符号链接实现文件共享
* 是软链接
* 允许一个文件或子目录有多个父目录，但其中仅有一个作为主父目录，其他父目录都是通过符号链接的方式与之相链接的。
* *实线*链接的为主父目录，*虚线*的为链接父目录
* 由系统创建一个LINK类型的新文件，其中只包含链接文件的路径名，这样的链接方法被称为符号链接。
* 优点：主父目录不需要时可以将文件删除，删除后发现访问失败，再将符号链删除
* 缺点：每次访问共享文件时，可能都要多次地读盘；每一个共享文件都有几个文件名

### 第八章 磁盘存储器的管理
* 外存的组织方式
    - 连续组织方式
        + 物理结构为顺序式的文件结构
        + 优点：顺序访问容易、速度快
        + 缺点：要求为一个文件分配连续的存储空间、必须事先知道文件的长度、不能灵活地删除和插入文件、对于动态增长的文件很难分配空间
    - 链接组织方式
        + 优点：消除了磁盘的外部碎片，提高了外存的利用率、对插入删除和修改就都非常容易、能适应文件的动态增长，无需事先知道文件的大小、
        + 分为隐式链接和显示链接
    - 索引组织方式
        + 索引式的文件结构
            * 单级索引的组织方式
            * 多级索引的组织方式
            * 增量式索引组织方式 *重点*（P259,图8-8）
                - 小作业（文件<40kb）：直接寻址，即把盘块地址都直接放入文件控制块FCB（或索引结点）
                - 中作业（文件<4MB)：采用单级索引组织方式。
                - 大型作业(文件>40KB+4MB)：采用两级和三级索引组织方式
                - unix system v的组织方式
                    + 在索引结点中设有13个地址项，i.addr(0)~i.addr(12)
                    + 直接地址，i.addr(0)~i.addr(9)存放直接地址，40KB文件
                    + 一次间接地址，i.addr(10)提供一次间接地址4KB*1K = 4MB
                    + 多次间接地址：i.addr(11)二次间接（4GB），i.addr(12)三次间接地址（4TB）

#### 文件存储空间的管理
* 空闲表法
* 空闲链表法
    - 空闲盘块链
    - 空闲盘区链
* 位示图
* 成组链接法 *重点*P262
    - UNIX系统中使用
    - 系统要为用户分配文件所需盘块的时候，须调用*盘块分配过程*来完成。首先检查空闲盘块号栈是否上锁，如未上锁，便从栈顶取出一空闲盘块号，与之对应的盘块分配给用户，然后将栈顶指针下移一格；如果已经是栈底，则须调用*磁盘读过程*将栈底盘块号所对应盘块的内容读入栈中，作为新的盘块号栈的内容，并把原栈底嘴硬的盘块分配出去。然后再分配以相应的缓冲区，最后把栈中的空闲盘块数减1.
    - 回收空闲盘块时，须调用*盘块回收过程*进行回收，是将回收盘块的盘块号记入空闲盘块号栈的顶部，并执行空闲盘块数加1的操作。当栈中空闲盘块号数已达100，表示栈已满，便将现有栈中的100个盘块号记入新回收的盘块中，再将其盘块号作为栈底。                    
                                                                              
### 大题 
电梯算法、一二级索引、动态分区分配
页面置换、混合索引、磁盘调度

### 名词
* 动态分区算法
FF   首次适应
NF   循环首次适应
BF   最佳适应
WF   最坏适应

TLB  快表
FCB  文件控制块

* 置换算法
Optimal 最佳置换算法
FIFO 先进先出置换算法
LRU 最近最久未使用
LFU 最少使用
* 磁盘调度算法
FCFS 先来先服务
SSTF 最短寻道时间
SCAN 扫描算法
CSCAN 循环扫描







